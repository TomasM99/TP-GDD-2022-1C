USE [GD1C2022]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE SCHEMA OMEGA
GO

BEGIN TRANSACTION
GO

/*CREACION DE TABLAS*/

CREATE TABLE [OMEGA].[CIRCUITO] (
  [CODIGO_CIRCUITO] [int] NOT NULL,
  [NOMBRE] [nvarchar](255) NULL,
  [PAIS] [nvarchar](255) NULL,
  PRIMARY KEY ([CODIGO_CIRCUITO])
)ON [PRIMARY]

CREATE TABLE [OMEGA].[MOTOR] (
  [NUMERO_SERIE] [nvarchar](255) NOT NULL,
  [MODELO] [nvarchar](255) NULL,
  PRIMARY KEY ([NUMERO_SERIE])
)ON [PRIMARY]

CREATE TABLE [OMEGA].[CAJA] (
  [NUMERO_SERIE] [nvarchar](255) NOT NULL,
  [MODELO] [nvarchar](255) NULL,
  PRIMARY KEY ([NUMERO_SERIE])
)ON [PRIMARY]

CREATE TABLE [OMEGA].[FRENO] (
  [NUMERO_SERIE] [nvarchar](255) NOT NULL,
  [TAMANIO_DISCO] [decimal](18, 2) NULL,
  [POSICION] [nvarchar](255) NULL,
  PRIMARY KEY ([NUMERO_SERIE])
)ON [PRIMARY]

CREATE TABLE [OMEGA].[TIPO_NEUMATICO] (
  [ID_TIPO_NEUMATICO] [int] IDENTITY(1,1) NOT NULL,
  [TIPO] [nvarchar](255) NULL,
  PRIMARY KEY ([ID_TIPO_NEUMATICO])
)ON [PRIMARY]

CREATE TABLE [OMEGA].[TIPO_SECTOR] (
  [ID_TIPO_SECTOR] [int] IDENTITY(1,1) NOT NULL,
  [TIPO] [nvarchar](255) NULL,
  PRIMARY KEY ([ID_TIPO_SECTOR])
)ON [PRIMARY]

CREATE TABLE [OMEGA].[TIPO_INCIDENTE] (
  [ID_TIPO_INCIDENTE] [int] IDENTITY(1,1) NOT NULL,
  [TIPO] [nvarchar](255) NULL,
  PRIMARY KEY ([ID_TIPO_INCIDENTE])
)ON [PRIMARY]

CREATE TABLE [OMEGA].[PILOTO] (
  [ID_PILOTO] [int] IDENTITY(1,1) NOT NULL,
  [NOMBRE] [nvarchar](255) NULL,
  [APELLIDO] [nvarchar](255) NULL,
  [NACIONALIDAD] [nvarchar](255) NULL,
  [FECHA_NACIMIENTO] [date] NULL,
  PRIMARY KEY ([ID_PILOTO])
)ON [PRIMARY]

CREATE TABLE [OMEGA].[ESCUDERIA] (
  [ID_ESCUDERIA] [int] IDENTITY(1,1) NOT NULL,
  [NOMBRE] [nvarchar](255) NULL,
  [NACIONALIDAD] [nvarchar](255) NULL,
  PRIMARY KEY ([ID_ESCUDERIA])
)ON [PRIMARY]


CREATE TABLE [OMEGA].[NEUMATICO] (
  [NUMERO_SERIE] [nvarchar](255) NOT NULL,
  [POSICION] [nvarchar](255) NULL,
  [TIPO] [int] NULL REFERENCES [OMEGA].[TIPO_NEUMATICO]([ID_TIPO_NEUMATICO]),
  PRIMARY KEY ([NUMERO_SERIE])
)ON [PRIMARY]

CREATE TABLE [OMEGA].[CARRERA] (
  [CODIGO_CARRERA] [int] NOT NULL,
  [FECHA] [date] NULL,
  [CLIMA] [nvarchar](100) NULL,
  [TOTAL_KM] [decimal](18, 2) NULL,
  [CANT_VUELTAS] [int] NULL,
  [CODIGO_CIRCUITO] [int] NULL REFERENCES [OMEGA].[CIRCUITO]([CODIGO_CIRCUITO]),
  PRIMARY KEY ([CODIGO_CARRERA])
)ON [PRIMARY]

CREATE TABLE [OMEGA].[SECTOR] (
  [CODIGO_SECTOR] [int] NOT NULL,
  [DISTANCIA] [decimal](18, 2) NULL,
  [TIPO] [int] NULL,
  [CODIGO_CIRCUITO] [int] NULL,
  PRIMARY KEY ([CODIGO_SECTOR]),
  CONSTRAINT [FK_SECTOR.TIPO]
    FOREIGN KEY ([TIPO])
      REFERENCES [OMEGA].[TIPO_SECTOR]([ID_TIPO_SECTOR]),
  CONSTRAINT [FK_SECTOR.CODIGO_CIRCUITO]
    FOREIGN KEY ([CODIGO_CIRCUITO])
      REFERENCES [OMEGA].[CIRCUITO]([CODIGO_CIRCUITO]),
)ON [PRIMARY]

CREATE TABLE [OMEGA].[INCIDENTE] (
  [ID_INCIDENTE] [int] IDENTITY(1,1) NOT NULL,
  [BANDERA] [nvarchar](255) NULL,
  [TIEMPO] [decimal](18, 2) NULL,
  [TIPO] [int] NULL,
  [CODIGO_SECTOR] [int] NULL,
  PRIMARY KEY ([ID_INCIDENTE]),
  CONSTRAINT [FK_INCIDENTE.TIPO]
    FOREIGN KEY ([TIPO])
      REFERENCES [OMEGA].[TIPO_INCIDENTE]([ID_TIPO_INCIDENTE]),
  CONSTRAINT [FK_INCIDENTE.CODIGO_SECTOR]
    FOREIGN KEY ([CODIGO_SECTOR])
      REFERENCES [OMEGA].[SECTOR]([CODIGO_SECTOR]),
)ON [PRIMARY]

CREATE TABLE [OMEGA].[AUTO] (
  [ID_AUTO] [int] IDENTITY(1,1) NOT NULL,
  [NUMERO_AUTO] [int] NULL,
  [MODELO] [nvarchar](255) NULL,
  [ID_ESCUDERIA] [int] NULL,
  [ID_PILOTO] [int] NULL,
  PRIMARY KEY ([ID_AUTO]),
  CONSTRAINT [FK_AUTO.ID_ESCUDERIA]
    FOREIGN KEY ([ID_ESCUDERIA])
      REFERENCES [OMEGA].[ESCUDERIA]([ID_ESCUDERIA]),
  CONSTRAINT [FK_AUTO.ID_PILOTO]
    FOREIGN KEY ([ID_PILOTO])
      REFERENCES [OMEGA].[PILOTO]([ID_PILOTO]),
)ON [PRIMARY]

CREATE TABLE [OMEGA].[INCIDENTE_AUTO] (
  [ID_INCIDENTE_AUTO] [int] IDENTITY(1,1) NOT NULL,
  [NUMERO_VUELTA] [decimal](18, 0) NULL,
  [ID_AUTO] [int] NULL,
  [ID_INCIDENTE] [int] NULL,
  PRIMARY KEY ([ID_INCIDENTE_AUTO]),
  CONSTRAINT [FK_INCIDENTE_AUTO.ID_AUTO]
    FOREIGN KEY ([ID_AUTO])
      REFERENCES [OMEGA].[AUTO]([ID_AUTO]),
  CONSTRAINT [FK_INCIDENTE_AUTO.ID_INCIDENTE]
    FOREIGN KEY ([ID_INCIDENTE])
      REFERENCES [OMEGA].[INCIDENTE]([ID_INCIDENTE]),
)ON [PRIMARY]

CREATE TABLE [OMEGA].[PARADA_BOX] (
  [ID_PARADA] [int] IDENTITY(1,1) NOT NULL,
  [NUMERO_VUELTA] [decimal](18, 0) NULL,
  [TIEMPO] [decimal](18, 2) NULL,
  [ID_AUTO] [int] NULL,
  [CODIGO_CARRERA] [int] NULL,
  PRIMARY KEY ([ID_PARADA]),
  CONSTRAINT [FK_PARADA.ID_AUTO]
    FOREIGN KEY ([ID_AUTO])
      REFERENCES [OMEGA].[AUTO]([ID_AUTO]),
)ON [PRIMARY]

CREATE TABLE [OMEGA].[NEUMATICO_VIEJO] (
  [NUMERO_SERIE] [nvarchar](255) NOT NULL,
  [POSICION] [nvarchar](255) NULL,
  [TIPO] [int] NULL,
  [ID_PARADA] [int] NULL,
  PRIMARY KEY ([NUMERO_SERIE]),
  CONSTRAINT [FK_NEUMATICO_VIEJO.TIPO]
    FOREIGN KEY ([TIPO])
      REFERENCES [OMEGA].[TIPO_NEUMATICO]([ID_TIPO_NEUMATICO]),
  CONSTRAINT [FK_NEUMATICO_VIEJO.ID_PARADA]
    FOREIGN KEY ([ID_PARADA])
      REFERENCES [OMEGA].[PARADA_BOX]([ID_PARADA]),
)ON [PRIMARY]

CREATE TABLE [OMEGA].[NEUMATICO_NUEVO] (
  [NUMERO_SERIE] [nvarchar](255) NOT NULL,
  [POSICION] [nvarchar](255) NULL,
  [TIPO] [int] NULL,
  [ID_PARADA] [int] NULL,
  PRIMARY KEY ([NUMERO_SERIE]),
  CONSTRAINT [FK_NEUMATICO_NUEVO.TIPO]
    FOREIGN KEY ([TIPO])
      REFERENCES [OMEGA].[TIPO_NEUMATICO]([ID_TIPO_NEUMATICO]),
  CONSTRAINT [FK_NEUMATICO_NUEVO.ID_PARADA]
    FOREIGN KEY ([ID_PARADA])
      REFERENCES [OMEGA].[PARADA_BOX]([ID_PARADA]),
)ON [PRIMARY]

CREATE TABLE [OMEGA].[MEDICION] (
  [CODIGO_MEDICION] [decimal](18, 0) NOT NULL,
  [NUMERO_VUELTA] [decimal](18, 0) NULL,
  [DISTANCIA_VUELTA] [decimal](18, 2) NULL,
  [DISTANCIA_CARRERA] [decimal](18, 2) NULL,
  [POSICION] [decimal](18,0) NULL,
  [TIEMPO_VUELTA] [decimal](18, 10) NULL,
  [VELOCIDAD] [decimal](18, 2) NULL,
  [COMBUSTIBLE] [decimal](18, 2) NULL,
  [CODIGO_CARRERA] [int] NULL,
  [CODIGO_SECTOR] [int] NULL,
  [ID_AUTO] [int] NULL,
  PRIMARY KEY ([CODIGO_MEDICION]),
  CONSTRAINT [FK_MEDICION.CODIGO_CARRERA]
    FOREIGN KEY ([CODIGO_CARRERA])
      REFERENCES [OMEGA].[CARRERA]([CODIGO_CARRERA]),
  CONSTRAINT [FK_MEDICION.CODIGO_SECTOR]
    FOREIGN KEY ([CODIGO_SECTOR])
      REFERENCES [OMEGA].[SECTOR]([CODIGO_SECTOR]),
  CONSTRAINT [FK_MEDICION.ID_AUTO]
    FOREIGN KEY ([ID_AUTO])
      REFERENCES [OMEGA].[AUTO]([ID_AUTO]),
)ON [PRIMARY]

CREATE TABLE [OMEGA].[TELEMETRIA_CAJA] (
  [ID_TELEMETRIA_CAJA] [int] IDENTITY(1,1) NOT NULL,
  [TEMP_ACEITE] [decimal](18, 2) NULL,
  [RPM] [decimal](18, 2) NULL,
  [DESGASTE] [decimal](18, 2) NULL,
  [NUMERO_SERIE] [nvarchar](255) NULL,
  [CODIGO_MEDICION] [decimal](18, 0) NULL,
  PRIMARY KEY ([ID_TELEMETRIA_CAJA]),
  CONSTRAINT [FK_TELEMETRIA_CAJA.NUMERO_SERIE]
    FOREIGN KEY ([NUMERO_SERIE])
      REFERENCES [OMEGA].[CAJA]([NUMERO_SERIE]),
  CONSTRAINT [FK_TELEMETRIA_CAJA.CODIGO_MEDICION]
    FOREIGN KEY ([CODIGO_MEDICION])
      REFERENCES [OMEGA].[MEDICION]([CODIGO_MEDICION]),
)ON [PRIMARY]

CREATE TABLE [OMEGA].[TELEMETRIA_MOTOR] (
  [ID_TELEMETRIA_MOTOR] [int] IDENTITY(1,1) NOT NULL,
  [POTENCIA] [decimal](18, 6) NULL,
  [TEMP_ACEITE] [decimal](18, 6) NULL,
  [RPM] [decimal](18, 6) NULL,
  [TEMP_AGUA] [decimal](18, 6) NULL,
  [NUMERO_SERIE] [nvarchar](255) NULL,
  [CODIGO_MEDICION] [decimal](18, 0) NULL,
  PRIMARY KEY ([ID_TELEMETRIA_MOTOR]),
  CONSTRAINT [FK_TELEMETRIA_MOTOR.NUMERO_SERIE]
    FOREIGN KEY ([NUMERO_SERIE])
      REFERENCES [OMEGA].[MOTOR]([NUMERO_SERIE]),
  CONSTRAINT [FK_TELEMETRIA_MOTOR.CODIGO_MEDICION]
    FOREIGN KEY ([CODIGO_MEDICION])
      REFERENCES [OMEGA].[MEDICION]([CODIGO_MEDICION]),
)ON [PRIMARY]

CREATE TABLE [OMEGA].[TELEMETRIA_FRENO] (
  [ID_TELEMETRIA_FRENO] [int] IDENTITY(1,1) NOT NULL,
  [TEMPERATURA] [decimal](18, 2) NULL,
  [GROSOR_PASTILLA] [decimal](18, 2) NULL,
  [NUMERO_SERIE] [nvarchar](255) NULL,
  [CODIGO_MEDICION] [decimal](18, 0) NULL,
  PRIMARY KEY ([ID_TELEMETRIA_FRENO]),
  CONSTRAINT [FK_TELEMETRIA_FRENO.NUMERO_SERIE]
    FOREIGN KEY ([NUMERO_SERIE])
      REFERENCES [OMEGA].[FRENO]([NUMERO_SERIE]),
  CONSTRAINT [FK_TELEMETRIA_FRENO.CODIGO_MEDICION]
    FOREIGN KEY ([CODIGO_MEDICION])
      REFERENCES [OMEGA].[MEDICION]([CODIGO_MEDICION]),
)ON [PRIMARY]

CREATE TABLE [OMEGA].[TELEMETRIA_NEUMATICO] (
  [ID_TELEMETRIA_NEUMATICO] [int] IDENTITY(1,1) NOT NULL,
  [PRESION] [decimal](18, 2) NULL,
  [PROFUNDIDAD] [decimal](18, 6) NULL,
  [TEMPERATURA] [decimal](18, 6) NULL,
  [NUMERO_SERIE] [nvarchar](255) NULL,
  [CODIGO_MEDICION] [decimal](18, 0) NULL,
  PRIMARY KEY ([ID_TELEMETRIA_NEUMATICO]),
  CONSTRAINT [FK_TELEMETRIA_NEUMATICO.NUMERO_SERIE]
    FOREIGN KEY ([NUMERO_SERIE])
      REFERENCES [OMEGA].[NEUMATICO]([NUMERO_SERIE]),
  CONSTRAINT [FK_TELEMETRIA_NEUMATICO.CODIGO_MEDICION]
    FOREIGN KEY ([CODIGO_MEDICION])
      REFERENCES [OMEGA].[MEDICION]([CODIGO_MEDICION]),
)ON [PRIMARY]

COMMIT
GO

/*FIN CREACION DE TABLAS*/

/*MIGRACION DE DATOS*/

BEGIN TRANSACTION

/*CIRCUITO*/

INSERT INTO [OMEGA].[CIRCUITO] (CODIGO_CIRCUITO, NOMBRE, PAIS)
SELECT DISTINCT CIRCUITO_CODIGO, CIRCUITO_NOMBRE, CIRCUITO_PAIS
FROM [gd_esquema].[Maestra] WHERE CIRCUITO_CODIGO IS NOT NULL

/*MOTOR*/

INSERT INTO [OMEGA].[MOTOR] (NUMERO_SERIE, MODELO) 
SELECT DISTINCT TELE_MOTOR_NRO_SERIE, TELE_MOTOR_MODELO 
FROM [gd_esquema].Maestra WHERE TELE_MOTOR_NRO_SERIE IS NOT NULL

/*CAJA*/

INSERT INTO [OMEGA].[CAJA] (NUMERO_SERIE, MODELO)
SELECT DISTINCT TELE_CAJA_NRO_SERIE, TELE_CAJA_MODELO
FROM [gd_esquema].Maestra WHERE TELE_CAJA_NRO_SERIE IS NOT NULL

/*FRENO*/

INSERT INTO [OMEGA].[FRENO] (NUMERO_SERIE, TAMANIO_DISCO, POSICION)
SELECT DISTINCT TELE_FRENO1_NRO_SERIE, TELE_FRENO1_TAMANIO_DISCO, TELE_FRENO1_POSICION
FROM [gd_esquema].Maestra WHERE  TELE_FRENO1_NRO_SERIE IS NOT NULL

INSERT INTO [OMEGA].[FRENO] (NUMERO_SERIE, TAMANIO_DISCO, POSICION)
SELECT DISTINCT TELE_FRENO2_NRO_SERIE, TELE_FRENO2_TAMANIO_DISCO, TELE_FRENO2_POSICION
FROM [gd_esquema].Maestra WHERE  TELE_FRENO2_NRO_SERIE IS NOT NULL

INSERT INTO [OMEGA].[FRENO] (NUMERO_SERIE, TAMANIO_DISCO, POSICION)
SELECT DISTINCT TELE_FRENO3_NRO_SERIE, TELE_FRENO3_TAMANIO_DISCO, TELE_FRENO3_POSICION
FROM [gd_esquema].Maestra WHERE  TELE_FRENO3_NRO_SERIE IS NOT NULL

INSERT INTO [OMEGA].[FRENO] (NUMERO_SERIE, TAMANIO_DISCO, POSICION)
SELECT DISTINCT TELE_FRENO4_NRO_SERIE, TELE_FRENO4_TAMANIO_DISCO, TELE_FRENO4_POSICION
FROM [gd_esquema].Maestra WHERE  TELE_FRENO4_NRO_SERIE IS NOT NULL

/*TIPO_NEUMATICO*/

INSERT INTO [OMEGA].[TIPO_NEUMATICO] (TIPO)
SELECT DISTINCT NEUMATICO1_TIPO_NUEVO
FROM [gd_esquema].Maestra WHERE  NEUMATICO1_TIPO_NUEVO IS NOT NULL 


/*TIPO_SECTOR*/

INSERT INTO [OMEGA].[TIPO_SECTOR] (TIPO)
SELECT DISTINCT SECTO_TIPO 
FROM [gd_esquema].Maestra WHERE SECTO_TIPO IS NOT NULL

/*TIPO_INCIDENTE*/

INSERT INTO [OMEGA].[TIPO_INCIDENTE] (TIPO)
SELECT DISTINCT INCIDENTE_TIPO 
FROM [gd_esquema].Maestra WHERE INCIDENTE_TIPO  IS NOT NULL

/*PILOTO*/

INSERT INTO [OMEGA].[PILOTO] (NOMBRE, APELLIDO, NACIONALIDAD, FECHA_NACIMIENTO)
SELECT DISTINCT PILOTO_NOMBRE, PILOTO_APELLIDO, PILOTO_NACIONALIDAD, PILOTO_FECHA_NACIMIENTO 
FROM [gd_esquema].[Maestra] WHERE  PILOTO_NOMBRE IS NOT NULL

/*ESCUDERIA*/

INSERT INTO [OMEGA].[ESCUDERIA] (NOMBRE, NACIONALIDAD)
SELECT DISTINCT ESCUDERIA_NOMBRE, ESCUDERIA_NACIONALIDAD
FROM [gd_esquema].[Maestra] WHERE ESCUDERIA_NOMBRE IS NOT NULL


/*CARRERA*/

INSERT INTO [OMEGA].[CARRERA] (CODIGO_CARRERA, FECHA, CLIMA, TOTAL_KM, CANT_VUELTAS, CODIGO_CIRCUITO)
SELECT DISTINCT m.CODIGO_CARRERA, m.CARRERA_FECHA, m.CARRERA_CLIMA, m.CARRERA_TOTAL_CARRERA, m.CARRERA_CANT_VUELTAS, c.CODIGO_CIRCUITO
FROM [gd_esquema].Maestra m, [OMEGA].CIRCUITO c
WHERE m.CIRCUITO_CODIGO = c.CODIGO_CIRCUITO AND m.CODIGO_CARRERA IS NOT NULL

/*SECTOR*/

INSERT INTO [OMEGA].[SECTOR] (CODIGO_SECTOR, DISTANCIA, TIPO, CODIGO_CIRCUITO)
SELECT DISTINCT m.CODIGO_SECTOR, m.SECTOR_DISTANCIA, t.ID_TIPO_SECTOR, c.CODIGO_CIRCUITO
FROM [gd_esquema].[Maestra] m, [OMEGA].CIRCUITO c, [OMEGA].TIPO_SECTOR t
WHERE  m.SECTO_TIPO = t.TIPO AND m.CIRCUITO_CODIGO = c.CODIGO_CIRCUITO AND m.CODIGO_SECTOR IS NOT NULL


/*AUTO*/

INSERT INTO [OMEGA].[AUTO] (NUMERO_AUTO, MODELO, ID_ESCUDERIA, ID_PILOTO)
SELECT DISTINCT m.AUTO_NUMERO, m.AUTO_MODELO, e.ID_ESCUDERIA, p.ID_PILOTO
FROM [gd_esquema].[Maestra] m, [OMEGA].ESCUDERIA e, [OMEGA].PILOTO p
WHERE m.ESCUDERIA_NOMBRE = e.NOMBRE AND m.ESCUDERIA_NACIONALIDAD = e.NACIONALIDAD AND
m.PILOTO_APELLIDO = p.APELLIDO AND m.PILOTO_FECHA_NACIMIENTO = p.FECHA_NACIMIENTO AND m.AUTO_NUMERO IS NOT NULL

/*INCIDENTE*/ --OK

INSERT INTO [OMEGA].[INCIDENTE] (BANDERA, TIEMPO, TIPO, CODIGO_SECTOR)
SELECT DISTINCT m.INCIDENTE_BANDERA, m.INCIDENTE_TIEMPO, t.ID_TIPO_INCIDENTE, s.CODIGO_SECTOR
FROM [gd_esquema].[Maestra] m, [OMEGA].TIPO_INCIDENTE t, [OMEGA].SECTOR s, OMEGA.[AUTO] a JOIN OMEGA.ESCUDERIA e ON (a.ID_ESCUDERIA = e.ID_ESCUDERIA)
WHERE  m.INCIDENTE_TIPO = t.TIPO AND m.CODIGO_SECTOR = s.CODIGO_SECTOR  AND m.AUTO_NUMERO = a.NUMERO_AUTO AND m.ESCUDERIA_NOMBRE = e.NOMBRE AND m.CODIGO_SECTOR IS NOT NULL


/*INCIDENTE_AUTO*/

INSERT INTO [OMEGA].[INCIDENTE_AUTO] (NUMERO_VUELTA, ID_AUTO, ID_INCIDENTE)
SELECT DISTINCT m.INCIDENTE_NUMERO_VUELTA, a.ID_AUTO, i.ID_INCIDENTE
FROM gd_esquema.Maestra m, [OMEGA].INCIDENTE i JOIN OMEGA.TIPO_INCIDENTE ti ON (i.TIPO = ti.ID_TIPO_INCIDENTE), [OMEGA].[AUTO] a JOIN OMEGA.ESCUDERIA e ON (a.ID_ESCUDERIA = e.ID_ESCUDERIA)																	
WHERE a.MODELO = m.AUTO_MODELO AND a.NUMERO_AUTO = m.AUTO_NUMERO AND e.NOMBRE = m.ESCUDERIA_NOMBRE
AND i.BANDERA = m.INCIDENTE_BANDERA AND i.TIEMPO = m.INCIDENTE_TIEMPO AND ti.TIPO = m.INCIDENTE_TIPO AND i.CODIGO_SECTOR = m.CODIGO_SECTOR

/*PARADA_BOX*/ --OK

INSERT INTO [OMEGA].[PARADA_BOX] (NUMERO_VUELTA, TIEMPO, ID_AUTO, c.CODIGO_CARRERA)
SELECT DISTINCT m.PARADA_BOX_VUELTA, m.PARADA_BOX_TIEMPO, a.ID_AUTO, c.CODIGO_CARRERA
FROM [gd_esquema].[Maestra] m, [OMEGA].[AUTO] a, OMEGA.CARRERA c
WHERE m.AUTO_MODELO = a.MODELO AND m.AUTO_NUMERO = a.NUMERO_AUTO AND m.CODIGO_CARRERA = c.CODIGO_CARRERA  AND m.PARADA_BOX_VUELTA IS NOT NULL


/*NEUMATICO_VIEJO*/

INSERT INTO [OMEGA].[NEUMATICO_VIEJO] (NUMERO_SERIE, POSICION, TIPO, ID_PARADA)
SELECT DISTINCT m.NEUMATICO1_NRO_SERIE_VIEJO, m.NEUMATICO1_POSICION_VIEJO, t.ID_TIPO_NEUMATICO, p.ID_PARADA
FROM [gd_esquema].[Maestra] m, [OMEGA].TIPO_NEUMATICO t, [OMEGA].PARADA_BOX p
WHERE m.NEUMATICO1_TIPO_VIEJO = t.TIPO AND m.PARADA_BOX_VUELTA = p.NUMERO_VUELTA 
AND m.PARADA_BOX_TIEMPO = p.TIEMPO AND m.NEUMATICO1_NRO_SERIE_VIEJO IS NOT NULL

INSERT INTO [OMEGA].[NEUMATICO_VIEJO] (NUMERO_SERIE, POSICION, TIPO, ID_PARADA)
SELECT DISTINCT m.NEUMATICO2_NRO_SERIE_VIEJO, m.NEUMATICO2_POSICION_VIEJO, t.ID_TIPO_NEUMATICO, p.ID_PARADA
FROM [gd_esquema].[Maestra] m, [OMEGA].TIPO_NEUMATICO t, [OMEGA].PARADA_BOX p
WHERE m.NEUMATICO2_TIPO_VIEJO = t.TIPO AND m.PARADA_BOX_VUELTA = p.NUMERO_VUELTA 
AND m.PARADA_BOX_TIEMPO = p.TIEMPO AND m.NEUMATICO2_NRO_SERIE_VIEJO IS NOT NULL

INSERT INTO [OMEGA].[NEUMATICO_VIEJO] (NUMERO_SERIE, POSICION, TIPO, ID_PARADA)
SELECT DISTINCT m.NEUMATICO3_NRO_SERIE_VIEJO, m.NEUMATICO3_POSICION_VIEJO, t.ID_TIPO_NEUMATICO, p.ID_PARADA
FROM [gd_esquema].[Maestra] m, [OMEGA].TIPO_NEUMATICO t, [OMEGA].PARADA_BOX p
WHERE m.NEUMATICO3_TIPO_VIEJO = t.TIPO AND m.PARADA_BOX_VUELTA = p.NUMERO_VUELTA 
AND m.PARADA_BOX_TIEMPO = p.TIEMPO AND m.NEUMATICO3_NRO_SERIE_VIEJO IS NOT NULL

INSERT INTO [OMEGA].[NEUMATICO_VIEJO] (NUMERO_SERIE, POSICION, TIPO, ID_PARADA)
SELECT DISTINCT m.NEUMATICO4_NRO_SERIE_VIEJO, m.NEUMATICO4_POSICION_VIEJO, t.ID_TIPO_NEUMATICO, p.ID_PARADA
FROM [gd_esquema].[Maestra] m, [OMEGA].TIPO_NEUMATICO t, [OMEGA].PARADA_BOX p
WHERE m.NEUMATICO4_TIPO_VIEJO = t.TIPO AND m.PARADA_BOX_VUELTA = p.NUMERO_VUELTA 
AND m.PARADA_BOX_TIEMPO = p.TIEMPO AND m.NEUMATICO4_NRO_SERIE_VIEJO IS NOT NULL

/*NEUMATICO_NUEVO*/

INSERT INTO [OMEGA].[NEUMATICO_NUEVO] (NUMERO_SERIE, POSICION, TIPO, ID_PARADA)
SELECT DISTINCT m.NEUMATICO1_NRO_SERIE_NUEVO, m.NEUMATICO1_POSICION_NUEVO, t.ID_TIPO_NEUMATICO, p.ID_PARADA
FROM [gd_esquema].[Maestra] m, [OMEGA].TIPO_NEUMATICO t, [OMEGA].PARADA_BOX p
WHERE m.NEUMATICO1_TIPO_NUEVO = t.TIPO AND m.PARADA_BOX_VUELTA = p.NUMERO_VUELTA 
AND m.PARADA_BOX_TIEMPO = p.TIEMPO AND m.NEUMATICO1_NRO_SERIE_NUEVO IS NOT NULL

INSERT INTO [OMEGA].[NEUMATICO_NUEVO] (NUMERO_SERIE, POSICION, TIPO, ID_PARADA)
SELECT DISTINCT m.NEUMATICO2_NRO_SERIE_NUEVO, m.NEUMATICO2_POSICION_NUEVO, t.ID_TIPO_NEUMATICO, p.ID_PARADA
FROM [gd_esquema].[Maestra] m, [OMEGA].TIPO_NEUMATICO t, [OMEGA].PARADA_BOX p
WHERE m.NEUMATICO2_TIPO_NUEVO = t.TIPO AND m.PARADA_BOX_VUELTA = p.NUMERO_VUELTA 
AND m.PARADA_BOX_TIEMPO = p.TIEMPO AND m.NEUMATICO2_NRO_SERIE_NUEVO IS NOT NULL

INSERT INTO [OMEGA].[NEUMATICO_NUEVO] (NUMERO_SERIE, POSICION, TIPO, ID_PARADA)
SELECT DISTINCT m.NEUMATICO3_NRO_SERIE_NUEVO, m.NEUMATICO3_POSICION_NUEVO, t.ID_TIPO_NEUMATICO, p.ID_PARADA
FROM [gd_esquema].[Maestra] m, [OMEGA].TIPO_NEUMATICO t, [OMEGA].PARADA_BOX p
WHERE m.NEUMATICO3_TIPO_NUEVO = t.TIPO AND m.PARADA_BOX_VUELTA = p.NUMERO_VUELTA 
AND m.PARADA_BOX_TIEMPO = p.TIEMPO AND m.NEUMATICO3_NRO_SERIE_NUEVO IS NOT NULL

INSERT INTO [OMEGA].[NEUMATICO_NUEVO] (NUMERO_SERIE, POSICION, TIPO, ID_PARADA)
SELECT DISTINCT m.NEUMATICO4_NRO_SERIE_NUEVO, m.NEUMATICO4_POSICION_NUEVO, t.ID_TIPO_NEUMATICO, p.ID_PARADA
FROM [gd_esquema].[Maestra] m, [OMEGA].TIPO_NEUMATICO t, [OMEGA].PARADA_BOX p
WHERE m.NEUMATICO4_TIPO_NUEVO = t.TIPO AND m.PARADA_BOX_VUELTA = p.NUMERO_VUELTA 
AND m.PARADA_BOX_TIEMPO = p.TIEMPO AND m.NEUMATICO4_NRO_SERIE_NUEVO IS NOT NULL

/*NEUMATICO*/

INSERT INTO [OMEGA].[NEUMATICO] (NUMERO_SERIE, POSICION, TIPO)
SELECT v.NUMERO_SERIE, v.POSICION, v.TIPO
FROM  [OMEGA].NEUMATICO_VIEJO v
UNION 
SELECT n.NUMERO_SERIE, n.POSICION, n.TIPO
FROM  [OMEGA].NEUMATICO_NUEVO n

/*MEDICION*/

INSERT INTO [OMEGA].[MEDICION] (CODIGO_MEDICION, NUMERO_VUELTA, DISTANCIA_VUELTA,
                                     DISTANCIA_CARRERA, POSICION, TIEMPO_VUELTA, VELOCIDAD, 
                                     COMBUSTIBLE, CODIGO_CARRERA, CODIGO_SECTOR, ID_AUTO)
SELECT DISTINCT m.TELE_AUTO_CODIGO, m.TELE_AUTO_NUMERO_VUELTA, m.TELE_AUTO_DISTANCIA_VUELTA, m.TELE_AUTO_DISTANCIA_CARRERA, 
                m.TELE_AUTO_POSICION, m.TELE_AUTO_TIEMPO_VUELTA, m.TELE_AUTO_VELOCIDAD, m.TELE_AUTO_COMBUSTIBLE, c.CODIGO_CARRERA, 
                s.CODIGO_SECTOR, a.ID_AUTO
FROM [gd_esquema].[Maestra] m, [OMEGA].[CARRERA] c, [OMEGA].SECTOR s, [OMEGA].[AUTO] a
WHERE m.CODIGO_SECTOR = s.CODIGO_SECTOR AND m.CODIGO_CARRERA = c.CODIGO_CARRERA AND m.AUTO_NUMERO = a.NUMERO_AUTO AND m.AUTO_MODELO = a.MODELO AND m.TELE_AUTO_CODIGO IS NOT NULL

/*TELEMETRIA_CAJA*/

INSERT INTO [OMEGA].[TELEMETRIA_CAJA] (TEMP_ACEITE, RPM, DESGASTE, NUMERO_SERIE, CODIGO_MEDICION)
SELECT DISTINCT x.TELE_CAJA_TEMP_ACEITE, x.TELE_CAJA_RPM, x.TELE_CAJA_DESGASTE, c.NUMERO_SERIE, m.CODIGO_MEDICION
FROM [gd_esquema].[Maestra] x, [OMEGA].[CAJA] c, [OMEGA].[MEDICION] m
WHERE x.TELE_CAJA_NRO_SERIE = c.NUMERO_SERIE AND x.TELE_AUTO_CODIGO = m.CODIGO_MEDICION  AND x.TELE_CAJA_TEMP_ACEITE IS NOT NULL

/*TELEMETRIA_MOTOR*/

INSERT INTO [OMEGA].[TELEMETRIA_MOTOR] (POTENCIA, TEMP_ACEITE, RPM, TEMP_AGUA, NUMERO_SERIE, CODIGO_MEDICION)
SELECT DISTINCT x.TELE_MOTOR_POTENCIA, x.TELE_MOTOR_TEMP_ACEITE, x.TELE_MOTOR_RPM, x.TELE_MOTOR_TEMP_AGUA, mo.NUMERO_SERIE, m.CODIGO_MEDICION
FROM [gd_esquema].[Maestra] x, [OMEGA].[MEDICION] m, [OMEGA].[MOTOR] mo
WHERE x.TELE_MOTOR_NRO_SERIE = mo.NUMERO_SERIE AND x.TELE_AUTO_CODIGO = m.CODIGO_MEDICION  AND x.TELE_MOTOR_POTENCIA IS NOT NULL

/*TELEMETRIA_FRENO*/

INSERT INTO [OMEGA].[TELEMETRIA_FRENO] (TEMPERATURA, GROSOR_PASTILLA, NUMERO_SERIE, CODIGO_MEDICION)
SELECT DISTINCT x.TELE_FRENO1_TEMPERATURA, x.TELE_FRENO1_GROSOR_PASTILLA, f.NUMERO_SERIE, m.CODIGO_MEDICION
FROM [gd_esquema].[Maestra] x, [OMEGA].[MEDICION] m, [OMEGA].[FRENO] f
WHERE x.TELE_FRENO1_NRO_SERIE = f.NUMERO_SERIE AND x.TELE_AUTO_CODIGO = m.CODIGO_MEDICION  AND x.TELE_FRENO1_TEMPERATURA IS NOT NULL

INSERT INTO [OMEGA].[TELEMETRIA_FRENO] (TEMPERATURA, GROSOR_PASTILLA, NUMERO_SERIE, CODIGO_MEDICION)
SELECT DISTINCT x.TELE_FRENO2_TEMPERATURA, x.TELE_FRENO2_GROSOR_PASTILLA, f.NUMERO_SERIE, m.CODIGO_MEDICION
FROM [gd_esquema].[Maestra] x, [OMEGA].[MEDICION] m, [OMEGA].[FRENO] f
WHERE x.TELE_FRENO2_NRO_SERIE = f.NUMERO_SERIE AND x.TELE_AUTO_CODIGO = m.CODIGO_MEDICION  AND x.TELE_FRENO2_TEMPERATURA IS NOT NULL

INSERT INTO [OMEGA].[TELEMETRIA_FRENO] (TEMPERATURA, GROSOR_PASTILLA, NUMERO_SERIE, CODIGO_MEDICION)
SELECT DISTINCT x.TELE_FRENO3_TEMPERATURA, x.TELE_FRENO3_GROSOR_PASTILLA, f.NUMERO_SERIE, m.CODIGO_MEDICION
FROM [gd_esquema].[Maestra] x, [OMEGA].[MEDICION] m, [OMEGA].[FRENO] f
WHERE x.TELE_FRENO3_NRO_SERIE = f.NUMERO_SERIE AND x.TELE_AUTO_CODIGO = m.CODIGO_MEDICION  AND x.TELE_FRENO3_TEMPERATURA IS NOT NULL

INSERT INTO [OMEGA].[TELEMETRIA_FRENO] (TEMPERATURA, GROSOR_PASTILLA, NUMERO_SERIE, CODIGO_MEDICION)
SELECT DISTINCT x.TELE_FRENO4_TEMPERATURA, x.TELE_FRENO4_GROSOR_PASTILLA, f.NUMERO_SERIE, m.CODIGO_MEDICION
FROM [gd_esquema].[Maestra] x, [OMEGA].[MEDICION] m, [OMEGA].[FRENO] f
WHERE x.TELE_FRENO4_NRO_SERIE = f.NUMERO_SERIE AND x.TELE_AUTO_CODIGO = m.CODIGO_MEDICION  AND x.TELE_FRENO4_TEMPERATURA IS NOT NULL

/*TELEMETRIA_NEUMATICO*/

INSERT INTO [OMEGA].[TELEMETRIA_NEUMATICO] (PRESION, PROFUNDIDAD, TEMPERATURA, NUMERO_SERIE, CODIGO_MEDICION)
SELECT DISTINCT x.TELE_NEUMATICO1_PRESION, x.TELE_NEUMATICO1_PROFUNDIDAD, x.TELE_NEUMATICO1_TEMPERATURA, n.NUMERO_SERIE, m.CODIGO_MEDICION 
FROM [gd_esquema].[Maestra] x, [OMEGA].[NEUMATICO] n, [OMEGA].MEDICION m
WHERE x.TELE_NEUMATICO1_NRO_SERIE = n.NUMERO_SERIE AND  x.TELE_AUTO_CODIGO = m.CODIGO_MEDICION  AND x.TELE_NEUMATICO1_PRESION IS NOT NULL

INSERT INTO [OMEGA].[TELEMETRIA_NEUMATICO] (PRESION, PROFUNDIDAD, TEMPERATURA, NUMERO_SERIE, CODIGO_MEDICION)
SELECT DISTINCT x.TELE_NEUMATICO2_PRESION, x.TELE_NEUMATICO2_PROFUNDIDAD, x.TELE_NEUMATICO2_TEMPERATURA, n.NUMERO_SERIE, m.CODIGO_MEDICION 
FROM [gd_esquema].[Maestra] x, [OMEGA].[NEUMATICO] n, [OMEGA].MEDICION m
WHERE x.TELE_NEUMATICO2_NRO_SERIE = n.NUMERO_SERIE AND  x.TELE_AUTO_CODIGO = m.CODIGO_MEDICION  AND x.TELE_NEUMATICO2_PRESION IS NOT NULL

INSERT INTO [OMEGA].[TELEMETRIA_NEUMATICO] (PRESION, PROFUNDIDAD, TEMPERATURA, NUMERO_SERIE, CODIGO_MEDICION)
SELECT DISTINCT x.TELE_NEUMATICO3_PRESION, x.TELE_NEUMATICO3_PROFUNDIDAD, x.TELE_NEUMATICO3_TEMPERATURA, n.NUMERO_SERIE, m.CODIGO_MEDICION 
FROM [gd_esquema].[Maestra] x, [OMEGA].[NEUMATICO] n, [OMEGA].MEDICION m
WHERE x.TELE_NEUMATICO3_NRO_SERIE = n.NUMERO_SERIE AND  x.TELE_AUTO_CODIGO = m.CODIGO_MEDICION  AND x.TELE_NEUMATICO3_PRESION IS NOT NULL

INSERT INTO [OMEGA].[TELEMETRIA_NEUMATICO] (PRESION, PROFUNDIDAD, TEMPERATURA, NUMERO_SERIE, CODIGO_MEDICION)
SELECT DISTINCT x.TELE_NEUMATICO4_PRESION, x.TELE_NEUMATICO4_PROFUNDIDAD, x.TELE_NEUMATICO4_TEMPERATURA, n.NUMERO_SERIE, m.CODIGO_MEDICION 
FROM [gd_esquema].[Maestra] x, [OMEGA].[NEUMATICO] n, [OMEGA].MEDICION m
WHERE x.TELE_NEUMATICO4_NRO_SERIE = n.NUMERO_SERIE AND  x.TELE_AUTO_CODIGO = m.CODIGO_MEDICION  AND x.TELE_NEUMATICO4_PRESION IS NOT NULL

/*FIN MIGRACION DE DATOS*/
COMMIT
GO